# 小天纠错系统 🔧

> 自我检测、错误识别、快速修复、持续改进

---

## 🎯 纠错能力定义

### 1. 预防性纠错（事前）
- **输入验证**：检查用户指令的完整性和合理性
- **权限确认**：执行敏感操作前二次确认
- **范围检查**：确保操作在授权范围内
- **备份习惯**：修改前自动备份原文件

### 2. 实时纠错（事中）
- **异常捕获**：捕获执行错误并记录
- **失败重试**：网络/临时错误自动重试
- **降级策略**：主方案失败时启用备选
- **进度保存**：长时间任务定期保存进度

### 3. 事后纠错（事后）
- **错误记录**：详细记录错误信息
- **根因分析**：分析错误根本原因
- **修复执行**：执行修复操作
- **经验沉淀**：更新知识库避免再犯

---

## 📝 纠错流程

```
开始执行任务
    ↓
检查前置条件 → 不满足 → 报错/请求补充
    ↓ 满足
执行操作
    ↓
检查执行结果 → 失败 → 进入纠错流程
    ↓ 成功
记录成功日志
    ↓
结束
```

### 纠错流程详情
```
执行失败
    ↓
捕获错误信息（类型、消息、堆栈）
    ↓
判断错误类型
    ├─ 网络错误 → 重试（最多3次）
    ├─ 权限错误 → 请求授权
    ├─ 资源不存在 → 创建/请求路径
    ├─ 格式错误 → 自动修正/请求确认
    └─ 未知错误 → 记录并汇报
    ↓
执行修复
    ↓
记录到 ERROR_LOG.md
    ↓
通知洛君（如需要）
```

---

## 🛡️ 常见错误类型与对策

| 错误类型 | 示例 | 自动对策 | 人工介入 |
|----------|------|----------|----------|
| 网络超时 | curl 失败 | 重试3次，指数退避 | 持续失败 |
| 文件不存在 | ENOENT | 检查路径，尝试创建 | 路径错误 |
| 权限不足 | EACCES | 请求提升权限 | 系统限制 |
| 格式错误 | JSON parse | 尝试修复，请求确认 | 严重损坏 |
| 依赖缺失 | command not found | 尝试安装 | 安装失败 |
| 配置错误 | config missing | 使用默认值，提示 | 关键配置 |

---

## 📊 错误记录格式

```markdown
## YYYY-MM-DD HH:mm | 错误编号 #001

**类型**: 网络错误/权限错误/格式错误...
**任务**: 正在执行什么操作
**错误信息**: 原始错误信息
**根因**: 为什么会发生
**修复**: 如何解决的
**预防**: 下次如何避免
```

---

## 🧪 纠错案例库

### Case #001: 网络下载失败
- **场景**: 下载 GitHub CLI 失败
- **原因**: 网络不稳定，多种下载方式均失败
- **对策**: 转由洛君手动安装
- **改进**: 建立离线安装包备份机制

### Case #002: 目录创建失败
- **场景**: mkdir -p 在 PowerShell 中失败
- **原因**: Unix 语法不兼容 Windows
- **对策**: 使用 New-Item -ItemType Directory
- **改进**: 建立跨平台命令库

---

## 🔄 持续改进机制

### 每日自检
- [ ] 检查错误日志
- [ ] 分析错误模式
- [ ] 更新预防策略

### 每周复盘
- [ ] 统计错误类型分布
- [ ] 优化纠错流程
- [ ] 更新文档

### 每月进化
- [ ] 评估纠错能力有效性
- [ ] 引入新的纠错策略
- [ ] 自动化常见修复

---

*错误是最好的老师，但同一个错误不要犯两次。*
